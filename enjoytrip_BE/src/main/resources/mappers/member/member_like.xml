<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.trip.domain.member.repository.MemberLikeDao">
	
	<select id="selectArticleLikesByMemberId">
		SELECT a.id, a.title, a.created_at
		FROM article_like al
			INNER JOIN article a ON al.article_id = a.id
		WHERE al.member_id = #{memberId}
		  AND al.deleted_at IS NULL
		  AND a.deleted_at IS NULL
		ORDER BY al.created_at DESC
		LIMIT #{size} OFFSET #{offset}	
	</select>
	
	<select id="countArticleLikesByMemberId">
		select count(*) from article_like where member_id = #{memberId} AND deleted_at IS NULL
	</select>
	
	<select id="selectAttractionLikesByMemberId" resultMap="attractionMap">
		SELECT 
		    a.id, a.title, a.address1, a.image1,
		    c.category_name
		FROM attraction_like al
			JOIN attraction a ON al.attraction_id = a.id
			LEFT JOIN category c ON a.category_id = c.category_id
		WHERE al.member_id = #{memberId}
		  AND al.deleted_at IS NULL
		ORDER BY al.created_at DESC
		LIMIT #{size} OFFSET #{offset}		
	</select>
	
	<select id="countAttractionLikesByMemberId">
			select count(*) from attraction_like where member_id = #{memberId} AND deleted_at IS NULL
	</select>
	
	<select id="selectMemberPlaceLikesByMemberId" resultMap="memberPlaceMap">
		SELECT 
		    mp.id, mp.name, mp.address, mp.image,
		    c.category_name
		FROM member_place mp
			JOIN member_place_like mpl ON mp.id = mpl.member_place_id
			LEFT JOIN category c ON mp.category_id = c.category_id
		WHERE mpl.member_id = #{memberId}
  			AND mp.deleted_at IS NULL
  			AND mpl.deleted_at IS NULL
		ORDER BY mpl.created_at DESC
		LIMIT #{size} OFFSET #{offset}
	</select>
	
	<select id="countMemberPlaceLikesByMemberId">
			select count(*) from member_place_like where member_id = #{memberId} AND deleted_at IS NULL
	</select>
	
	<select id="selectTripPlanLikesByMemberId">
		SELECT tp.id, tp.title, tp.start_date, tp.end_date
		FROM trip_plan_like tpl
			JOIN trip_plan tp ON tpl.trip_plan_id = tp.id
		WHERE tpl.member_id = #{memberId}
		  AND tpl.deleted_at IS NULL
		  AND tp.deleted_at IS NULL
		ORDER BY tpl.created_at DESC
		LIMIT #{size} OFFSET #{offset}					
	</select>
	
	<select id="countTripPlanLikesByMemberId">
			select count(*) from trip_plan_like where member_id = #{memberId} AND deleted_at IS NULL
	</select>
	
	<resultMap type="Attraction" id="attractionMap">
		<id column="id" property="id"/>
		<result column="title" property="title"/>
		<result column="address1" property="address1"/>
		<result column="image1" property="image1"/>
		<association property="category" javaType="Category">
			<result column="category_name" property="categoryName"/>
		</association>
	</resultMap>
	
	<resultMap type="MemberPlace" id="memberPlaceMap">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<result column="address" property="address"/>
		<result column="image" property="image"/>
		<association property="category" javaType="Category">
			<result column="category_name" property="categoryName"/>
		</association>
	</resultMap>
	
</mapper>